<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü—Ä–∏–∫–∞–∑–Ω–∏ –ó–∞—Ä—á–µ—Ç–∞</title>
    <style>
        :root {
            --bg-color: #f0f8ff;
            --card-bg: #ffffff;
            --primary-btn: #FF9800;
            --refresh-btn: #2196F3;

            --cat-hero-bg: #e8f5e9;
            --cat-hero-border: #4CAF50;
            --cat-item-bg: #fffde7;
            --cat-item-border: #FFC107;
            --cat-place-bg: #ffebee;
            --cat-place-border: #F44336;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Verdana', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 10px;
            /* –ö–õ–Æ–ß–û–í–û: –ó–∞–µ–º–∞ —Ü–µ–ª–∏—è –µ–∫—Ä–∞–Ω –∏ –ø–æ–¥—Ä–µ–∂–¥–∞ –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ –≤–µ—Ä—Ç–∏–∫–∞–ª–Ω–æ */
            height: 100dvh; /* dvh –µ –ø–æ-–¥–æ–±—Ä–æ –∑–∞ –º–æ–±–∏–ª–Ω–∏ –æ—Ç vh */
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden; /* –°–ø–∏—Ä–∞–º–µ —Å–∫—Ä–æ–ª–∞ –Ω–∞ —Ü—è–ª–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */
        }

        h1 {
            margin: 0 0 5px 0;
            font-size: 1.4rem;
            color: #ff5722;
            flex: 0 0 auto; /* –ù–µ —Å–µ —Å–≤–∏–≤–∞/—Ä–∞–∑—Ç—è–≥–∞ */
        }

        /* –°—É–ø–µ—Ä –∫–æ–º–ø–∞–∫—Ç–Ω–∞ –ª–µ–≥–µ–Ω–¥–∞ */
        .legend-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 0.75rem;
            background: white;
            padding: 4px 10px;
            border-radius: 15px;
            flex: 0 0 auto;
        }

        .legend-item { display: flex; align-items: center; gap: 4px; font-weight: bold; }
        .dot { width: 8px; height: 8px; border-radius: 50%; }
        .dot.hero { background: var(--cat-hero-border); }
        .dot.item { background: var(--cat-item-border); }
        .dot.place { background: var(--cat-place-border); }

        .controls {
            margin-bottom: 5px;
            flex: 0 0 auto;
        }

        select {
            font-size: 0.9rem;
            padding: 2px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        /* --- –ì–ï–ô–ú –ë–û–†–î --- */
        .game-board {
            /* –ó–∞–µ–º–∞ —Ü—è–ª–æ—Ç–æ –æ—Å—Ç–∞–Ω–∞–ª–æ —Å–≤–æ–±–æ–¥–Ω–æ –º—è—Å—Ç–æ –º–µ–∂–¥—É –º–µ–Ω—é—Ç–æ –∏ –±—É—Ç–æ–Ω–∞ */
            flex: 1 1 auto;
            width: 100%;
            max-width: 600px;

            display: grid;
            grid-template-columns: 1fr 1fr; /* 2 –∫–æ–ª–æ–Ω–∏ */
            /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏ —Ä–µ–¥–æ–≤–µ, –∫–æ–∏—Ç–æ —Å–µ –æ–ø–∏—Ç–≤–∞—Ç –¥–∞ —Å–µ —Å—ä–±–µ—Ä–∞—Ç –≤—ä–≤ –≤–∏—Å–æ—á–∏–Ω–∞—Ç–∞ */
            grid-auto-rows: minmax(0, 1fr);
            gap: 6px; /* –ú–∞–ª–∫–æ —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ */

            padding: 5px 0;
            overflow-y: auto; /* –í –∫—Ä–∞–µ–Ω —Å–ª—É—á–∞–π —Å–∫—Ä–æ–ª —Å–∞–º–æ —Ç—É–∫ */
        }

        /* –ü—Ä–∏ 3 –∫–æ–ª–æ–Ω–∏ –Ω–∞ –ø–æ-—à–∏—Ä–æ–∫–∏ –µ–∫—Ä–∞–Ω–∏ */
        @media (min-width: 500px) {
            .game-board {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;

            /* –ú–∏–Ω–∏–º–∞–ª–Ω–∏ –æ—Ç—Å—Ç–æ—è–Ω–∏—è –≤—ä—Ç—Ä–µ */
            padding: 4px;
            position: relative;
            border-bottom: 4px solid #ccc;
            cursor: pointer;

            /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä–∞–º–µ, —á–µ –∫–∞—Ä—Ç–∞—Ç–∞ –Ω—è–º–∞ –¥–∞ —Å—Ç–∞–Ω–µ —Ç–≤—ä—Ä–¥–µ –≤–∏—Å–æ–∫–∞ */
            height: 100%;
            max-height: 25vh; /* –ü—Ä–µ–¥–ø–∞–∑–Ω–∞ –º—è—Ä–∫–∞ */
        }

        .card:active { transform: scale(0.97); }

        .card.cat-hero { background: var(--cat-hero-bg); border-color: var(--cat-hero-border); }
        .card.cat-item { background: var(--cat-item-bg); border-color: var(--cat-item-border); }
        .card.cat-place { background: var(--cat-place-bg); border-color: var(--cat-place-border); }

        .card.speaking { outline: 3px solid #2196F3; }

        .card-icon {
            font-size: 2.5rem; /* –ü–æ-–º–∞–ª–∫–∏ –∏–∫–æ–Ω–∏ */
            line-height: 1;
            margin-bottom: 2px;
        }

        .card-text {
            font-size: 0.8rem; /* –ü–æ-–º–∞–ª—ä–∫ —à—Ä–∏—Ñ—Ç */
            font-weight: bold;
            text-align: center;
            line-height: 1.1;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .swap-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(255,255,255,0.7);
            color: var(--refresh-btn);
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 24px; /* –ü–æ-–º–∞–ª–∫–æ –±—É—Ç–æ–Ω—á–µ */
            height: 24px;
            font-size: 0.9rem;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
        }

        /* –ë—É—Ç–æ–Ω—ä—Ç –≤–µ—á–µ –Ω–µ –µ fixed, –∞ flex item */
        .main-action {
            flex: 0 0 auto; /* –§–∏–∫—Å–∏—Ä–∞–Ω–∞ –≤–∏—Å–æ—á–∏–Ω–∞ */
            margin-top: 5px;
            background-color: var(--primary-btn);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            width: 80%;
            max-width: 300px;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px) rotate(-3deg); }
            75% { transform: translateX(3px) rotate(3deg); }
        }
        .animate-pop { animation: popIn 0.3s ease-out; }
        .animate-shake { animation: shake 0.3s ease-in-out; }
    </style>
</head>
<body>

    <h1>–†–∞–∑–∫–∞–∂–∏ –ø—Ä–∏–∫–∞–∑–∫–∞</h1>

    <div class="legend-container">
        <div class="legend-item"><span class="dot hero"></span> –ì–µ—Ä–æ–π</div>
        <div class="legend-item"><span class="dot item"></span> –ü—Ä–µ–¥–º–µ—Ç</div>
        <div class="legend-item"><span class="dot place"></span> –ú—è—Å—Ç–æ</div>
    </div>

    <div class="controls">
        <label for="count-select">–ë—Ä–æ–π:</label>
        <select id="count-select" onchange="rollAll()">
            <option value="3" selected>3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
        </select>
    </div>

    <div id="game-board" class="game-board"></div>

    <button class="main-action" onclick="rollAllWithAnimation()">
        üé≤ –•–í–™–†–õ–ò –í–°–ò–ß–ö–ò
    </button>

    <script>
        // –î–ê–ù–ù–ò
        const db = [
            { id: 1, text: "–ú–æ–º—á–µ", icon: "üë¶", cat: "hero" },
            { id: 2, text: "–ú–æ–º–∏—á–µ", icon: "üëß", cat: "hero" },
            { id: 3, text: "–ë–µ–±–µ", icon: "üë∂", cat: "hero" },
            { id: 4, text: "–ë–∞–±–∞ –∏ –î—è–¥–æ", icon: "üëµüë¥", cat: "hero" },
            { id: 5, text: "–°—É–ø–µ—Ä–≥–µ—Ä–æ–π", icon: "ü¶∏", cat: "hero" },
            { id: 6, text: "–ü–∏—Ä–∞—Ç", icon: "üè¥‚Äç‚ò†Ô∏è", cat: "hero" },
            { id: 7, text: "–ö—É—á–µ", icon: "üê∂", cat: "hero" },
            { id: 8, text: "–ö–æ—Ç–∫–∞", icon: "üê±", cat: "hero" },
            { id: 9, text: "–ó–∞–π—á–µ", icon: "üê∞", cat: "hero" },
            { id: 10, text: "–ü—Ç–∏—á–µ", icon: "üê¶", cat: "hero" },
            { id: 11, text: "–ö–æ–Ω—á–µ", icon: "üê¥", cat: "hero" },
            { id: 12, text: "–°–ª–æ–Ω—á–µ", icon: "üêò", cat: "hero" },
            { id: 13, text: "–î—Ä–∞–∫–æ–Ω", icon: "üê≤", cat: "hero" },
            { id: 14, text: "–î–∏–Ω–æ–∑–∞–≤—ä—Ä", icon: "ü¶ñ", cat: "hero" },
            { id: 15, text: "–†–æ–±–æ—Ç", icon: "ü§ñ", cat: "hero" },
            { id: 16, text: "–ò–∑–≤—ä–Ω–∑–µ–º–Ω–æ", icon: "üëΩ", cat: "hero" },
            { id: 17, text: "–§–µ—è", icon: "üßö‚Äç‚ôÄÔ∏è", cat: "hero" },
            { id: 18, text: "–†–∏—Ü–∞—Ä", icon: "üõ°Ô∏è", cat: "hero" },
            { id: 19, text: "–¢–æ–ø–∫–∞", icon: "‚öΩ", cat: "item" },
            { id: 20, text: "–ü–ª—é—à–µ–Ω–æ –º–µ—á–µ", icon: "üß∏", cat: "item" },
            { id: 21, text: "–ö–æ–ª–∏—á–∫–∞", icon: "üöó", cat: "item" },
            { id: 22, text: "–ö—É–∫–ª–∞", icon: "üéé", cat: "item" },
            { id: 23, text: "–ë–∞–ª–æ–Ω", icon: "üéà", cat: "item" },
            { id: 24, text: "–ö–Ω–∏–≥–∞", icon: "üìñ", cat: "item" },
            { id: 25, text: "–û—á–∏–ª–∞", icon: "üëì", cat: "item" },
            { id: 26, text: "–õ—ä–∂–∏—Ü–∞", icon: "ü•Ñ", cat: "item" },
            { id: 27, text: "–û–±—É–≤–∫–∏", icon: "üëü", cat: "item" },
            { id: 28, text: "–ö–ª—é—á", icon: "üîë", cat: "item" },
            { id: 29, text: "–§–µ–Ω–µ—Ä—á–µ", icon: "üî¶", cat: "item" },
            { id: 30, text: "–ü–æ–¥–∞—Ä—ä–∫", icon: "üéÅ", cat: "item" },
            { id: 31, text: "–ö–æ–ª–µ–ª–æ", icon: "üö≤", cat: "item" },
            { id: 32, text: "–†–∞–∫–µ—Ç–∞", icon: "üöÄ", cat: "item" },
            { id: 33, text: "–õ–æ–¥–∫–∞", icon: "‚õµ", cat: "item" },
            { id: 34, text: "–í–ª–∞–∫", icon: "üöÇ", cat: "item" },
            { id: 35, text: "–í—ä–ª—à–µ–±–Ω–∞ –ø—Ä—ä—á–∫–∞", icon: "ü™Ñ", cat: "item" },
            { id: 36, text: "–¢–æ—Ä—Ç–∞", icon: "üéÇ", cat: "item" },
            { id: 37, text: "–ö—ä—â–∞", icon: "üè†", cat: "place" },
            { id: 38, text: "–£—á–∏–ª–∏—â–µ", icon: "üè´", cat: "place" },
            { id: 39, text: "–ü—ä—Ä–∑–∞–ª–∫–∞", icon: "üõù", cat: "place" },
            { id: 40, text: "–ì–æ—Ä–∞", icon: "üå≤", cat: "place" },
            { id: 41, text: "–ü–ª–∞–∂", icon: "üèñÔ∏è", cat: "place" },
            { id: 42, text: "–ö–æ—Å–º–æ—Å", icon: "ü™ê", cat: "place" },
            { id: 43, text: "–°–ª—ä–Ω—Ü–µ", icon: "‚òÄÔ∏è", cat: "place" },
            { id: 44, text: "–õ—É–Ω–∞", icon: "üåô", cat: "place" },
            { id: 45, text: "–î—ä–≥–∞", icon: "üåà", cat: "place" },
            { id: 46, text: "–î—ä–∂–¥", icon: "üåßÔ∏è", cat: "place" },
            { id: 47, text: "–°–Ω—è–≥", icon: "‚ùÑÔ∏è", cat: "place" },
            { id: 48, text: "–¶–≤–µ—Ç–µ", icon: "üå∏", cat: "place" },
            { id: 49, text: "–ü–µ—â–µ—Ä–∞", icon: "ü™®", cat: "place" },
            { id: 50, text: "–ó–∞–º—ä–∫", icon: "üè∞", cat: "place" },
            { id: 51, text: "–û—Å—Ç—Ä–æ–≤", icon: "üèùÔ∏è", cat: "place" },
            { id: 52, text: "–ü–ª–∞–Ω–∏–Ω–∞", icon: "üèîÔ∏è", cat: "place" },
            { id: 53, text: "–õ–µ–≥–ª–æ", icon: "üõèÔ∏è", cat: "place" },
            { id: 54, text: "–û–±–∏—á", icon: "‚ù§Ô∏è", cat: "place" }
        ];

        let currentItems = [];
        let voices = [];

        function initVoices() { voices = window.speechSynthesis.getVoices(); }
        if ('speechSynthesis' in window) {
            window.speechSynthesis.onvoiceschanged = initVoices;
            initVoices();
        }

        function speak(text, cardElement) {
            if (!('speechSynthesis' in window)) return;
            document.querySelectorAll('.card').forEach(c => c.classList.remove('speaking'));
            if(cardElement) {
                cardElement.classList.add('speaking');
                setTimeout(() => cardElement.classList.remove('speaking'), 1000);
            }
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            const bgVoice = voices.find(v => v.lang.includes('bg'));
            if (bgVoice) utterance.voice = bgVoice;
            utterance.lang = 'bg-BG';
            window.speechSynthesis.speak(utterance);
        }

        function shuffle(array) {
            let cur = array.length, rnd;
            while (cur != 0) {
                rnd = Math.floor(Math.random() * cur);
                cur--;
                [array[cur], array[rnd]] = [array[rnd], array[cur]];
            }
            return array;
        }

        function rollAllWithAnimation() {
            const board = document.getElementById('game-board');
            if (board.children.length > 0) {
                Array.from(board.children).forEach(c => c.classList.add('animate-shake'));
                setTimeout(rollAll, 300);
            } else {
                rollAll();
            }
        }

        function rollAll() {
            const count = parseInt(document.getElementById('count-select').value);
            const board = document.getElementById('game-board');
            board.innerHTML = '';

            let selection = [];
            if (count >= 3) {
                selection.push(shuffle(db.filter(x => x.cat === 'hero'))[0]);
                selection.push(shuffle(db.filter(x => x.cat === 'item'))[0]);
                selection.push(shuffle(db.filter(x => x.cat === 'place'))[0]);
            }

            const usedIds = selection.map(x => x.id);
            const remaining = shuffle(db.filter(x => !usedIds.includes(x.id)));

            while (selection.length < count) {
                selection.push(remaining.pop());
            }

            currentItems = shuffle(selection);
            currentItems.forEach((item, index) => createCardDOM(item, index));
        }

        function changeOne(index) {
            const visibleIds = currentItems.map(x => x.id);
            const available = db.filter(x => !visibleIds.includes(x.id));
            if(available.length === 0) return;

            const newItem = available[Math.floor(Math.random() * available.length)];
            currentItems[index] = newItem;

            const wrapper = document.createElement('div');
            createCardDOM(newItem, index, wrapper);
            document.getElementById('game-board').children[index].replaceWith(wrapper.firstElementChild);
        }

        function createCardDOM(item, index, parent = document.getElementById('game-board')) {
            const card = document.createElement('div');
            card.className = `card cat-${item.cat} animate-pop`;
            card.onclick = () => speak(item.text, card);

            const icon = document.createElement('div');
            icon.className = 'card-icon';
            icon.textContent = item.icon;

            const text = document.createElement('div');
            text.className = 'card-text';
            text.textContent = item.text;

            const btn = document.createElement('div');
            btn.className = 'swap-btn';
            btn.innerHTML = '‚Üª';
            btn.onclick = (e) => { e.stopPropagation(); changeOne(index); };

            card.appendChild(btn);
            card.appendChild(icon);
            card.appendChild(text);
            parent.appendChild(card);
        }

        window.onload = rollAll;
    </script>
</body>
</html>
